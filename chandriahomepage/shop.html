<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <!--=============== FLATICON ===============-->
        <link
            rel="stylesheet"
            href="https://cdn-uicons.flaticon.com/2.6.0/uicons-regular-straight/css/uicons-regular-straight.css"
        />

        <!--=============== SWIPER CSS ===============-->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
        />
        <!-- NOTYF CDN -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css"
        />
        <!--=============== CSS ===============-->
        <link rel="stylesheet" href="./assets/css/styles.css" />
        <link rel="stylesheet" href="./assets/css/shop.css" />

        <title>Chandria's La Robe</title>
    </head>
    <body>
        <!--=============== HEADER ===============-->
        <header class="header">
            <nav class="nav container">
                <a href="../index.html" class="nav-logo">
                    <img
                        src="assets/img/logo1.png"
                        alt=""
                        class="nav-logo-img"
                    />
                </a>

                <div class="nav-menu" id="nav-menu">
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="../index.html" class="nav-link">Home</a>
                        </li>

                        <li class="nav-item">
                            <a href="shop.html" class="nav-link active-link">Shop</a>
                        </li>
                    </ul>

                    <div class="header-search">
                        <input
                            type="text"
                            placeholder="Search"
                            class="form-input"
                        />
                        <button class="search-btn">
                            <img src="assets/img/search.png" alt="" />
                        </button>
                    </div>
                </div>

                <div class="header-user-actions">
                    <a href="wishlist.html" class="header-action-btn">
                        <img src="assets/img/icon-heart.svg" alt="" />
                        <span class="count">0</span>
                    </a>

                    <a href="./cart.html" class="header-action-btn">
                        <img src="assets/img/icon-cart.svg" alt="" />
                        <span class="count" id="cart-count">0</span>
                    </a>

                    <a href="accounts.html" class="header-action-btn">
                        <img src="assets/img/icon-user.svg" alt="" />
                    </a>
                </div>
            </nav>
        </header>
        <!--=============== MAIN ===============-->
        <main class="main">
            <!--=============== BREADCRUMB ===============-->
            <section class="breadcrumb">
                <ul class="breadcrumb-list flex container">
                    <li>
                        <a href="../index.html" class="breadcrumb-link">Home</a>
                    </li>
                    <li><span class="breadcrum-link">></span></li>
                    <li><span class="breadcrum-link">Shop</span></li>
                </ul>
            </section>

            <!--=============== PRODUCTS ===============-->
            <section class="products section-lg container">
                <!-- START OF MODAL CONTAINER -->
                <div class="cart-modal-container">
                    <div class="cart-modal">
                        <section class="details section-lg">
                            <div class="details-container container grid">
                                <div class="details-group">
                                    <img
                                        src="assets/img/product-6-1.jpg"
                                        alt=""
                                        class="details-img front-img"
                                    />

                                    <div class="details-small-images grid">
                                        <img
                                            src="assets/img/product-6-2.jpg"
                                            alt=""
                                            class="details-small-img back-img"
                                        />
                                        <img
                                            src="assets/img/product-6-1.jpg"
                                            alt=""
                                            class="details-small-img front-img"
                                        />
                                        <img
                                            src="assets/img/product-6-2.jpg"
                                            alt=""
                                            class="details-small-img back-img"
                                        />
                                    </div>
                                </div>
                                <div class="details-group">
                                    <h3
                                        class="details-title"
                                        id="product-name"
                                    ></h3>

                                    <div class="details-price flex">
                                        <span class="new-price">â‚± </span
                                        ><span
                                            class="new-price"
                                            id="product-price"
                                            >900</span
                                        >
                                    </div>

                                    <p
                                        class="short-description"
                                        id="product-description"
                                    ></p>

                                    <ul class="product-list">
                                        <li class="list-item flex">
                                            <i
                                                class="fi fi-rs-clothes-hanger"
                                            ></i>
                                            Free Fitting Service Before Rental
                                        </li>

                                        <li class="list-item flex">
                                            <i class="fi fi-rs-sparkles"></i>
                                            Pre-Cleaned and Sanitized
                                        </li>

                                        <li class="list-item flex">
                                            <i class="fi fi-rs-running"></i>
                                            Ready-to-Wear in Perfect Condition
                                        </li>
                                    </ul>

                                    <div class="details-color flex">
                                        <span class="details-color-title"
                                            >Color</span
                                        >
                                        <ul class="color-list">
                                            <li>
                                                <a
                                                    href="#"
                                                    class="color-link"
                                                    id="product-color"
                                                ></a>
                                            </li>
                                        </ul>
                                    </div>

                                    <div class="details-size flex">
                                        <span class="details-size-title"
                                            >Available Sizes</span
                                        >
                                        <ul
                                            class="size-list"
                                            id="product-sizes"
                                        >
                                            <li>
                                                <a
                                                    href="#"
                                                    class="size-link size-active"
                                                    >S</a
                                                >
                                            </li>

                                            <li>
                                                <a href="#" class="size-link"
                                                    >M</a
                                                >
                                            </li>
                                            <li>
                                                <a href="#" class="size-link"
                                                    >L</a
                                                >
                                            </li>
                                            <li>
                                                <a href="#" class="size-link"
                                                    >XL</a
                                                >
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="details-size flex" name="stock">
                                        <span class="details-size-title"
                                            >Available Stock: </span
                                        ><span id="size-available-stock"
                                            >0</span
                                        >
                                    </div>
                                    <div class="details-action">
                                        <input
                                            type="number"
                                            class="quantity"
                                            id="rent-quantity"
                                            value="1"
                                        />
                                        <input
                                            type="text"
                                            id="product-id"
                                            hidden
                                        />
                                        <button class="btn btn-sm" id="btn-rent">
                                            <span class="btn-text"
                                                >Add to Rent</span
                                            >
                                            <span
                                                class="spinner"
                                                style="display: none"
                                            ></span>
                                        </button>
                                        <button
                                            class="btn btn-sm close"
                                            id="btn-close"
                                        >
                                            Cancel
                                        </button>
                                    </div>

                                    <ul class="details-meta">
                                        <li class="meta-list flex">
                                            <span>PRODUCT CODE: </span
                                            ><span id="product-code"> </span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
                <!-- END OF MODAL CONTAINER -->

                <p class="total-products">
                    We found <span>120</span> items for you
                </p>
                
                <!-- PRODUCTS CONTAINER -->
                <div class="products-container grid">
                  
                </div>

                <ul class="pagination">
                    <li><a href="#" class="pagination-link active">01</a></li>
                    <li><a href="#" class="pagination-link">02</a></li>
                    <li><a href="#" class="pagination-link">03</a></li>
                    <li><a href="#" class="pagination-link">...</a></li>
                    <li><a href="#" class="pagination-link">12</a></li>
                    <li>
                        <a href="#" class="pagination-link icon">
                            <i class="fi-rs-angle-double-small-right"></i>
                        </a>
                    </li>
                </ul>
            </section>
        </main>

        <!--=============== LOGOUT MODAL ===============-->
        <div id="logout-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
            <div style="background:#fff; border-radius:10px; max-width:350px; width:90%; margin:auto; padding:2rem 1.5rem; box-shadow:0 2px 16px rgba(0,0,0,0.15); text-align:center;">
                <h3 style="color:#222; margin-bottom:1.5rem;">Are you sure you want to log out?</h3>
                <div style="display:flex; gap:1rem; justify-content:center;">
                    <button id="logout-yes" style="background:#ff9aaf; color:#fff; border:none; border-radius:5px; padding:0.5rem 1.5rem; font-weight:600; cursor:pointer;">Yes</button>
                    <button id="logout-no" style="background:#eee; color:#222; border:none; border-radius:5px; padding:0.5rem 1.5rem; font-weight:600; cursor:pointer;">No</button>
                </div>
            </div>
        </div>

        <!--=============== SWIPER JS ===============-->
        <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
        <!-- NOTYF CDN -->
        <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
        <!-- JQUERY CDN -->
        <script
            src="https://code.jquery.com/jquery-3.7.1.js"
            integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
            crossorigin="anonymous"
        ></script>
        <!--=============== MAIN JS ===============-->
        <script type="module" src="./assets/js/shop.js"></script>
        <script type="module">
            import { getAuth, onAuthStateChanged, signOut } from "./assets/js/sdk/chandrias-sdk.js";
            const auth = getAuth();
            const loginLogoutLink = document.getElementById('login-logout-link');
            const logoutModal = document.getElementById('logout-modal');
            const logoutYes = document.getElementById('logout-yes');
            const logoutNo = document.getElementById('logout-no');

            onAuthStateChanged(auth, (user) => {
              if (user) {
                loginLogoutLink.textContent = "Logout";
                loginLogoutLink.href = "#"; // Prevent navigation
                loginLogoutLink.onclick = (e) => {
                  e.preventDefault();
                  if(logoutModal) logoutModal.style.display = 'flex';
                };
              } else {
                loginLogoutLink.textContent = "Login";
                loginLogoutLink.href = "./user_authentication.html";
                loginLogoutLink.onclick = null; // Remove previous click handler
              }
            });

            if (logoutYes && logoutNo && logoutModal) {
              logoutYes.onclick = () => {
                signOut(auth).then(() => {
                  logoutModal.style.display = 'none';
                  window.location.reload(); // Or redirect to home/login page
                }).catch((error) => {
                  console.error("Sign out error", error);
                  // Optionally show an error message to the user
                  logoutModal.style.display = 'none';
                });
              };

              logoutNo.onclick = () => {
                logoutModal.style.display = 'none';
              };

              // Optional: close modal on outside click
              logoutModal.onclick = (e) => {
                if (e.target === logoutModal) {
                    logoutModal.style.display = 'none';
                }
              };
            }

            // Adjust profile link based on auth state
            const profileLink = document.querySelector('a.nav-link[href="./test_Profile.html"]');
            if (profileLink) {
                onAuthStateChanged(auth, (user) => {
                    profileLink.onclick = (e) => {
                        e.preventDefault();
                        if (user) {
                            window.location.href = "./accounts.html";
                        } else {
                            window.location.href = "./user_authentication.html";
                        }
                    };
                });
            }
        </script>        <script type="module">
            import { getAuth, onAuthStateChanged, signOut } from "./assets/js/sdk/chandrias-sdk.js";            const authInstance = getAuth();
            const loginLogoutLinkElement = document.getElementById('login-logout-link');

            // Conservative auto-logout: Only logout when browser/tab is actually closing
            let isNavigatingWithinSite = false;

            // Track internal navigation to prevent logout during site navigation
            document.addEventListener('click', (event) => {
                const link = event.target.closest('a');
                if (link && link.href) {
                    const currentDomain = window.location.hostname;
                    const linkUrl = new URL(link.href, window.location.origin);
                    
                    // If it's an internal link, mark as internal navigation
                    if (linkUrl.hostname === currentDomain) {
                        isNavigatingWithinSite = true;
                        // Reset the flag after a short delay
                        setTimeout(() => {
                            isNavigatingWithinSite = false;
                        }, 1000);
                    }
                }
            });

            // Only logout on actual browser close, not internal navigation
            window.addEventListener('beforeunload', async (event) => {
                // Don't logout if this is internal site navigation
                if (isNavigatingWithinSite) {
                    return;
                }
                
                // Only logout if user is authenticated
                if (authInstance.currentUser) {
                    try {
                        // Clear local storage
                        localStorage.removeItem('userEmail');
                        localStorage.removeItem('userProfilePicture');
                        
                        // Sign out from Firebase
                        await signOut(authInstance);
                        console.log('Auto-logout: User signed out on browser close');
                    } catch (error) {
                        console.error('Auto-logout error:', error);
                        // Clear local storage even if signOut fails
                        localStorage.removeItem('userEmail');
                        localStorage.removeItem('userProfilePicture');
                    }
                }
            });

            onAuthStateChanged(authInstance, (user) => {
              if (user) {
                loginLogoutLinkElement.style.display = 'none';
              } else {
                loginLogoutLinkElement.style.display = 'block';
                loginLogoutLinkElement.textContent = "Login";
                loginLogoutLinkElement.href = "./user_authentication.html";
              }
            });
        </script>
    </body>
</html>
