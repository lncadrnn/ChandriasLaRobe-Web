<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Chandria's La Robe - Inventory Management</title>
      <!-- Boxicons CSS -->
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    
    <!-- Cropper.js CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css" rel="stylesheet">
    
    <!-- Notyf CSS for notifications -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/reusable css/sidebar.css">
    <link rel="stylesheet" href="assets/css/inventory.css">
</head>
<body>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <img src="assets/img/logonobg.png" alt="Chandria's La Robe" class="logo-img">
            </div>
            <button class="toggle-btn" id="toggleBtn">
                <i class='bx bx-chevron-left'></i>
            </button>
        </div>
        
        <nav class="sidebar-nav">
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <i class='bx bxs-dashboard nav-icon'></i>
                        <span class="nav-text">Dashboard</span>
                    </a>
                </li>
                
                <li class="nav-item active">
                    <a href="inventory.html" class="nav-link">
                        <i class='bx bxs-t-shirt nav-icon'></i>
                        <span class="nav-text">Inventory</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a href="calendar.html" class="nav-link">
                        <i class='bx bxs-calendar nav-icon'></i>
                        <span class="nav-text">Calendar</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a href="rental.html" class="nav-link">
                        <i class='bx bxs-package nav-icon'></i>
                        <span class="nav-text">Rental</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a href="rental-history.html" class="nav-link">
                        <i class='bx bxs-user nav-icon'></i>
                        <span class="nav-text">Rental History</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a href="settings.html" class="nav-link">
                        <i class='bx bxs-cog nav-icon'></i>
                        <span class="nav-text">Settings</span>
                    </a>
                </li>
            </ul>
        </nav>
        
        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar">
                    <i class='bx bxs-user'></i>
                </div>
                <div class="user-details">
                    <span class="user-name">Admin</span>
                    <span class="user-role">Administrator</span>
                </div>
            </div>
            
            <button class="logout-btn">
                <i class='bx bx-log-out'></i>
                <span class="logout-text">Logout</span>
            </button>
        </div>
    </div>    <main class="main-content" id="mainContent">        <div class="page-header">
            <div class="header-left">
                <h1 class="page-title">Inventory Management</h1>
                <p class="page-subtitle">Manage Chandria's La Robe's inventory and product items</p>
            </div>
        </div><!-- Inventory Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn active" data-tab="products" id="productsTab">
                <i class='bx bxs-t-shirt'></i>
                Products
            </button>
            <button class="tab-btn" data-tab="additionals" id="additionalsTab">
                <i class='bx bxs-diamond'></i>
                Additionals (Accessories)
            </button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content active" id="productsContent">
            <div class="inventory-header">
                <h2>Products Inventory</h2>
                <button class="add-product-btn" id="addProductBtn">
                    <i class='bx bx-plus'></i>
                    Add Product
                </button>
            </div>
            
            <!-- Products will be listed here -->
            <div class="inventory-list" id="productsList">
                <div class="empty-message">
                    <i class='bx bx-package'></i>
                    <h3>No products added yet</h3>
                    <p>Click "Add Product" to start managing your inventory</p>
                </div>
            </div>
        </div>

        <div class="tab-content" id="additionalsContent">
            <div class="inventory-header">
                <h2>Additionals Inventory</h2>
                <button class="add-additional-btn" id="addAdditionalBtn">
                    <i class='bx bx-plus'></i>
                    Add Additional
                </button>
            </div>
            
            <!-- Additionals will be listed here -->
            <div class="inventory-list" id="additionalsList">
                <div class="empty-message">
                    <i class='bx bx-diamond'></i>
                    <h3>No additionals added yet</h3>
                    <p>Click "Add Additional" to start managing your accessories</p>
                </div>
            </div>
        </div>
    </main>    <!-- Add Product Modal -->
    <div class="modal" id="addProductModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class='bx bx-plus'></i>
                    Add New Product
                </h3>
                <button class="close-modal" id="closeAddProductModal">
                    <i class='bx bx-x'></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addProductForm">
                    <!-- Image Upload Section -->
                    <div class="image-upload-section">
                        <h4><i class='bx bx-image'></i> Product Images</h4>
                        <div class="image-upload-container">
                            <!-- Front Image Upload -->
                            <div class="image-upload-item">
                                <label>Front View</label>
                                <div class="image-drop-zone" id="frontImageZone">
                                    <div class="upload-placeholder" id="frontPlaceholder">
                                        <i class='bx bx-cloud-upload'></i>
                                        <p>Click or drag to upload front image</p>
                                        <small>JPG, PNG, WebP (Max 5MB)</small>
                                    </div>
                                    <div class="image-preview" id="frontPreview" style="display: none;">
                                        <img id="frontImage" src="" alt="Front view">
                                        <div class="image-actions">
                                            <button type="button" class="crop-btn" onclick="openImageCropper('front')">
                                                <i class='bx bx-crop'></i> Crop
                                            </button>
                                            <button type="button" class="remove-btn" onclick="removeImage('front')">
                                                <i class='bx bx-trash'></i> Remove
                                            </button>
                                        </div>
                                    </div>
                                    <input type="file" id="frontImageInput" accept="image/*" hidden>
                                </div>
                            </div>
                            

                            <!-- Back Image Upload -->
                            <div class="image-upload-item">
                                <label>Back View</label>
                                <div class="image-drop-zone" id="backImageZone">
                                    <div class="upload-placeholder" id="backPlaceholder">
                                        <i class='bx bx-cloud-upload'></i>
                                        <p>Click or drag to upload back image</p>
                                        <small>JPG, PNG, WebP (Max 5MB)</small>
                                    </div>
                                    <div class="image-preview" id="backPreview" style="display: none;">
                                        <img id="backImage" src="" alt="Back view">
                                        <div class="image-actions">
                                            <button type="button" class="crop-btn" onclick="openImageCropper('back')">
                                                <i class='bx bx-crop'></i> Crop
                                            </button>
                                            <button type="button" class="remove-btn" onclick="removeImage('back')">
                                                <i class='bx bx-trash'></i> Remove
                                            </button>
                                        </div>
                                    </div>
                                    <input type="file" id="backImageInput" accept="image/*" hidden>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Product Information -->
                    <div class="form-section">
                        <h4><i class='bx bx-info-circle'></i> Product Information</h4>
                          <div class="form-row">
                            <div class="form-group">
                                <label for="productName">Product Name *</label>
                                <input type="text" id="productName" placeholder="Enter product name" required>
                            </div>                            <div class="form-group">
                                <label for="productCode">Product Code *</label>
                                <input type="text" id="productCode" placeholder="Auto-generated" readonly>
                                <small class="help-text">This will be auto-generated based on category and color</small>
                            </div>
                        </div>
                          <div class="form-row">
                            <div class="form-group">
                                <label for="productCategory">Category *</label>
                                <select id="productCategory" required>
                                    <option value="">Select Category</option>
                                    <option value="ball-gown">Ball Gown</option>
                                    <option value="long-gown">Long Gown</option>
                                    <option value="fairy-gown">Fairy Gown</option>
                                    <option value="wedding-gown">Wedding Gown</option>
                                    <option value="suit">Suit</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="productColor">Color *</label>
                                <select id="productColor" required>
                                    <option value="">Select Color</option>
                                    <!-- Primary Colors -->
                                    <optgroup label="Primary Colors">
                                        <option value="Red" data-hex="#FF0000">Red</option>
                                        <option value="Blue" data-hex="#0000FF">Blue</option>
                                        <option value="Yellow" data-hex="#FFFF00">Yellow</option>
                                    </optgroup>
                                    <!-- Secondary Colors -->
                                    <optgroup label="Secondary Colors">
                                        <option value="Orange" data-hex="#FFA500">Orange</option>
                                        <option value="Green" data-hex="#008000">Green</option>
                                        <option value="Purple" data-hex="#800080">Purple</option>
                                        <option value="Pink" data-hex="#FFC0CB">Pink</option>
                                    </optgroup>
                                    <!-- Neutral Colors -->
                                    <optgroup label="Neutral Colors">
                                        <option value="White" data-hex="#FFFFFF">White</option>
                                        <option value="Black" data-hex="#000000">Black</option>
                                        <option value="Gray" data-hex="#808080">Gray</option>
                                        <option value="Brown" data-hex="#A52A2A">Brown</option>
                                        <option value="Beige" data-hex="#F5F5DC">Beige</option>
                                        <option value="Cream" data-hex="#FFFDD0">Cream</option>
                                    </optgroup>
                                    <!-- Fashion Colors -->
                                    <optgroup label="Fashion Colors">
                                        <option value="Navy Blue" data-hex="#2C3E50">Navy Blue</option>
                                        <option value="Ivory" data-hex="#F8F6F0">Ivory</option>
                                        <option value="Champagne" data-hex="#F7E7CE">Champagne</option>
                                        <option value="Nude" data-hex="#E8C5A0">Nude</option>
                                        <option value="Rose Gold" data-hex="#E8B4A0">Rose Gold</option>
                                        <option value="Silver" data-hex="#C0C0C0">Silver</option>
                                        <option value="Gold" data-hex="#FFD700">Gold</option>
                                        <option value="Burgundy" data-hex="#800020">Burgundy</option>
                                        <option value="Emerald" data-hex="#50C878">Emerald</option>
                                        <option value="Royal Blue" data-hex="#4169E1">Royal Blue</option>
                                    </optgroup>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="productRentalPrice">Rental Price (₱) *</label>
                                <input type="number" id="productRentalPrice" step="0.01" placeholder="0.00" required>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Additional Details -->
                    <div class="form-section">
                        <h4><i class='bx bx-cog'></i> Additional Details</h4>
                        
                        <div class="form-row">                            <div class="form-group">
                                <label for="productSizes">Available Sizes & Stock</label>
                                <div class="size-checkboxes">
                                    <label class="checkbox-label">
                                        <div class="size-row">
                                            <input type="checkbox" value="XS" onchange="toggleStockInput(this)"> 
                                            <span>XS</span>
                                        </div>
                                        <input type="number" class="stock-input" data-size="XS" placeholder="Stock" min="0" style="display: none;">
                                    </label>
                                    <label class="checkbox-label">
                                        <div class="size-row">
                                            <input type="checkbox" value="S" onchange="toggleStockInput(this)"> 
                                            <span>S</span>
                                        </div>
                                        <input type="number" class="stock-input" data-size="S" placeholder="Stock" min="0" style="display: none;">
                                    </label>
                                    <label class="checkbox-label">
                                        <div class="size-row">
                                            <input type="checkbox" value="M" onchange="toggleStockInput(this)"> 
                                            <span>M</span>
                                        </div>
                                        <input type="number" class="stock-input" data-size="M" placeholder="Stock" min="0" style="display: none;">
                                    </label>
                                    <label class="checkbox-label">
                                        <div class="size-row">
                                            <input type="checkbox" value="L" onchange="toggleStockInput(this)"> 
                                            <span>L</span>
                                        </div>
                                        <input type="number" class="stock-input" data-size="L" placeholder="Stock" min="0" style="display: none;">
                                    </label>
                                    <label class="checkbox-label">
                                        <div class="size-row">
                                            <input type="checkbox" value="XL" onchange="toggleStockInput(this)"> 
                                            <span>XL</span>
                                        </div>
                                        <input type="number" class="stock-input" data-size="XL" placeholder="Stock" min="0" style="display: none;">
                                    </label>
                                    <label class="checkbox-label">
                                        <div class="size-row">
                                            <input type="checkbox" value="XXL" onchange="toggleStockInput(this)"> 
                                            <span>XXL</span>
                                        </div>
                                        <input type="number" class="stock-input" data-size="XXL" placeholder="Stock" min="0" style="display: none;">
                                    </label>
                                </div>
                            </div><div class="form-group">
                                <label for="productSleeves">Sleeve Style</label>
                                <select id="productSleeves">
                                    <option value="">Select Sleeve Style</option>
                                    <option value="Off Shoulder">Off Shoulder</option>
                                    <option value="Long Sleeves">Long Sleeves</option>
                                    <option value="3/4 Sleeves">3/4 Sleeves</option>
                                    <option value="Short Sleeves">Short Sleeves</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Product Description at bottom -->
                        <div class="form-group">
                            <label for="productDescription">Description</label>
                            <textarea id="productDescription" rows="4" placeholder="Enter product description..."></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancelAddProductBtn">
                    <i class='bx bx-x'></i> Cancel
                </button>
                <button type="button" class="btn-primary" id="saveProductBtn">
                    <i class='bx bx-save'></i> Save Product
                </button>
            </div>
        </div>    </div>

    <!-- Image Cropper Modal -->
    <div class="modal" id="imageCropperModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content cropper-modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class='bx bx-crop'></i>
                    Crop Image (Portrait)
                </h3>
                <button class="close-modal" onclick="closeCropperModal()">
                    <i class='bx bx-x'></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="cropper-container">
                    <img id="cropperImage" src="" alt="Image to crop">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="closeCropperModal()">
                    <i class='bx bx-x'></i> Cancel
                </button>
                <button type="button" class="btn-primary" onclick="applyCrop()">
                    <i class='bx bx-check'></i> Apply Crop
                </button>
            </div>
        </div>
    </div>

    <!-- Add Additional Modal -->
    <div class="modal" id="addAdditionalModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class='bx bx-plus'></i>
                    Add New Additional
                </h3>
                <button class="close-modal" id="closeAddAdditionalModal">
                    <i class='bx bx-x'></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addAdditionalForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="additionalName">Additional Name</label>
                            <input type="text" id="additionalName" required>
                        </div>
                        <div class="form-group">
                            <label for="additionalType">Type</label>
                            <select id="additionalType" required>
                                <option value="">Select Type</option>
                                <option value="jewelry">Jewelry</option>
                                <option value="shoes">Shoes</option>
                                <option value="bags">Bags</option>
                                <option value="veils">Veils</option>
                                <option value="headpieces">Headpieces</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="additionalSize">Size (if applicable)</label>
                            <input type="text" id="additionalSize" placeholder="e.g., 7.5, One Size, etc.">
                        </div>
                        <div class="form-group">
                            <label for="additionalColor">Color</label>
                            <input type="text" id="additionalColor" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="additionalRentalPrice">Rental Price (₱)</label>
                            <input type="number" id="additionalRentalPrice" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="additionalStatus">Status</label>
                            <select id="additionalStatus" required>
                                <option value="available">Available</option>
                                <option value="maintenance">Maintenance</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="additionalDescription">Description</label>
                        <textarea id="additionalDescription" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="additionalImage">Image Upload</label>
                        <input type="file" id="additionalImage" accept="image/*">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelAddAdditionalBtn">Cancel</button>
                <button class="btn-primary" id="saveAdditionalBtn">Save Additional</button>
            </div>
        </div>
    </div>

    <!-- Item Details Modal -->
    <div class="modal" id="itemDetailsModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class='bx bx-info-circle'></i>
                    Item Details
                </h3>
                <button class="close-modal" id="closeDetailsModal">
                    <i class='bx bx-x'></i>
                </button>
            </div>
            <div class="modal-body" id="itemDetailsContent">
                <!-- Dynamic content will be loaded here -->
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="editItemBtn">
                    <i class='bx bx-edit'></i>
                    Edit Item
                </button>
                <button class="btn-danger" id="deleteItemBtn">
                    <i class='bx bx-trash'></i>
                    Delete Item
                </button>
            </div>
        </div>
    </div>    <!-- Error Modal -->
    <div id="error-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Error</h3>
                <span class="error-close close">&times;</span>
            </div>
            <div class="modal-body">
                <p id="error-modal-message">An error occurred.</p>
            </div>
            <div class="modal-footer">
                <button id="error-modal-ok" class="btn-primary">OK</button>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirm Action</h3>
                <span class="confirm-close close">&times;</span>
            </div>
            <div class="modal-body">
                <p id="confirm-modal-message">Are you sure?</p>
            </div>
            <div class="modal-footer">
                <button id="confirm-modal-cancel" class="btn-secondary">Cancel</button>
                <button id="confirm-modal-ok" class="btn-primary">OK</button>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div class="container-spinner d-none" id="spinner">
        <div class="spinner-overlay">
            <div class="spinner"></div>
            <div class="spinner-text" id="spinner-text">Loading...</div>
        </div>
    </div>

    <!-- JavaScript -->
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Cropper.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
    
    <!-- Notyf JS for notifications -->
    <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
      <!-- Custom JavaScript -->
    <script src="assets/js/sidebar.js"></script>
    <script src="assets/js/inventory.js"></script>
      <!-- Cloudinary Configuration -->
    <script src="assets/js/js firebase/cloudinary-config.js"></script>
    
    <!-- Cloudinary Upload Service -->
    <script src="assets/js/js firebase/inventory-cloud.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module" src="assets/js/js firebase/chandrias-sdk.js"></script>
    
    <!-- Inventory Fetching Service -->
    <script type="module" src="assets/js/js firebase/inventory-fetching.js"></script>    <script type="module">
        import InventoryFetcher from './assets/js/js firebase/inventory-fetching.js';
        
        // Make InventoryFetcher available globally
        window.InventoryFetcher = InventoryFetcher;// Initialize Notyf for notifications with auto-removal
        const notyf = new Notyf({
            duration: 3000, // 3 seconds display time
            position: { x: 'center', y: 'top' },
            dismissible: true,
            ripple: false, // Disable ripple effect for cleaner animations
            types: [
                {
                    type: 'success',
                    background: '#10b981', // Solid green
                    duration: 3000,
                    dismissible: true,
                    icon: {
                        className: 'bx bx-check-circle',
                        tagName: 'i',
                        text: '',
                        color: '#ffffff'
                    }
                },
                {
                    type: 'error',
                    background: '#ef4444', // Solid red
                    duration: 4000,
                    dismissible: true,
                    icon: {
                        className: 'bx bx-x-circle',
                        tagName: 'i',
                        text: '',
                        color: '#ffffff'
                    }
                },
                {
                    type: 'info',
                    background: '#3b82f6', // Solid blue
                    duration: 3000,
                    dismissible: true,
                    icon: {
                        className: 'bx bx-info-circle',
                        tagName: 'i',
                        text: '',
                        color: '#ffffff'
                    }
                },
                {
                    type: 'warning',
                    background: '#f59e0b', // Solid orange
                    duration: 3000,
                    dismissible: true,
                    icon: {
                        className: 'bx bx-error-circle',
                        tagName: 'i',
                        text: '',
                        color: '#ffffff'
                    }
                },
                {
                    type: 'firebase',
                    background: '#8b5cf6', // Solid purple
                    duration: 3000,
                    dismissible: true,
                    icon: {
                        className: 'bx bx-data',
                        tagName: 'i',
                        text: '',
                        color: '#ffffff'
                    }
                }
            ]
        });
        
        // Make Notyf available globally
        window.notyf = notyf;
          // Enhanced notification removal with proper cleanup
        const originalDismiss = notyf.dismiss;
        notyf.dismiss = function(notification) {
            if (notification && notification.targetElement) {
                // Add fade-out class for smooth animation
                notification.targetElement.classList.add('notyf__toast--disappear');
                
                // Remove after animation completes
                setTimeout(() => {
                    if (notification.targetElement && notification.targetElement.parentNode) {
                        originalDismiss.call(this, notification);
                    }
                }, 400); // Match the CSS animation duration
            } else {
                originalDismiss.call(this, notification);
            }
        };
        
        // Auto-dismiss with fade-out for all notifications
        const originalOpen = notyf.open;
        notyf.open = function(options) {
            const notification = originalOpen.call(this, options);
            
            // Set up auto-dismiss with smooth removal
            if (notification && notification.options && notification.options.duration) {
                setTimeout(() => {
                    if (notification.targetElement && 
                        notification.targetElement.parentNode && 
                        !notification.targetElement.classList.contains('notyf__toast--disappear')) {
                        this.dismiss(notification);
                    }
                }, notification.options.duration);
            }
            
            return notification;
        };
        
        // Additional cleanup function to ensure no lingering notifications
        const cleanupNotifications = () => {
            const notificationElements = document.querySelectorAll('.notyf__toast');
            notificationElements.forEach((element, index) => {
                // If notification has been visible for more than 10 seconds, force cleanup
                if (element.dataset.createdAt) {
                    const createdTime = parseInt(element.dataset.createdAt);
                    const now = Date.now();
                    if (now - createdTime > 10000) { // 10 seconds
                        element.classList.add('notyf__toast--disappear');
                        setTimeout(() => {
                            if (element.parentNode) {
                                element.remove();
                            }
                        }, 400);
                    }
                } else {
                    // Mark creation time for tracking
                    element.dataset.createdAt = Date.now().toString();
                }
            });
        };
        
        // Run cleanup every 5 seconds to ensure no notifications get stuck
        setInterval(cleanupNotifications, 5000);        // Initialize Firebase services when DOM is ready
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                console.log('Initializing Firebase inventory services...');
                
                // Test Firebase connection and initialize services
                const initResult = await InventoryFetcher.initialize();
                
                if (initResult.success) {
                    console.log('Firebase services ready:', initResult.message);
                      // Get initial statistics
                    const stats = await InventoryFetcher.getInventoryStats();
                    if (stats) {
                        console.log('Products in database:', stats.totalProducts);
                        console.log('Additionals in database:', stats.totalAdditionals);
                        
                        // notyf.success(`Connected to Firebase (${stats.totalProducts} products, ${stats.totalAdditionals} additionals found)`);
                    } else {
                        // notyf.success('Connected to Firebase');
                    }
                    
                    // Load initial data from Firebase
                    await loadInventoryFromFirebase();
                } else {
                    console.error('Failed to initialize Firebase services');
                    notyf.error('Failed to connect to Firebase');
                }
                
            } catch (error) {
                console.error('Error initializing Firebase:', error);
                notyf.error('Firebase connection failed');
                
                // Don't show additional alerts, let user use offline mode
                setTimeout(() => {
                    if (!window.InventoryFetcher || !window.InventoryFetcher.getConnectionStatus()) {
                        console.warn('Firebase connection still not available, using offline mode');
                    }
                }, 5000);
            }
        });        // Function to load inventory data from Firebase
        async function loadInventoryFromFirebase() {
            try {
                console.log('Loading inventory data from Firebase...');
                
                // Fetch products and additionals from Firebase using the new fetching service
                const [products, additionals] = await Promise.all([
                    InventoryFetcher.fetchProducts(),
                    InventoryFetcher.fetchAdditionals()
                ]);
                
                // Update global variables with Firebase data
                if (typeof window.updateInventoryData === 'function') {
                    window.updateInventoryData(products, additionals);
                } else {
                    // Fallback: directly update if function doesn't exist
                    console.log('Loaded products:', products);
                    console.log('Loaded additionals:', additionals);
                    
                    // Try to update the UI directly if possible
                    if (typeof window.sampleProducts !== 'undefined') {
                        window.sampleProducts.length = 0;
                        window.sampleProducts.push(...products);
                    }
                    
                    if (typeof window.sampleAdditionals !== 'undefined') {
                        window.sampleAdditionals.length = 0;
                        window.sampleAdditionals.push(...additionals);
                    }
                    
                    // Try to refresh UI
                    if (typeof window.loadProducts === 'function') {
                        window.loadProducts();
                    }
                    if (typeof window.loadAdditionals === 'function') {
                        window.loadAdditionals();
                    }
                }
                
                // Show product count notification only
                if (products.length > 0 || additionals.length > 0) {
                    notyf.success(`Loaded ${products.length} products and ${additionals.length} additionals`);
                }
                
            } catch (error) {
                console.error('Error loading inventory from Firebase:', error);
                notyf.error('Failed to load inventory data');
            }
        }
        
        // Make the load function available globally
        window.loadInventoryFromFirebase = loadInventoryFromFirebase;
    </script>
  
</body>
</html>
