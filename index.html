<!DOCTYPE html>
<html lang="en">  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-------------------------------- FLATICON --------------------------------->
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.6.0/uicons-regular-straight/css/uicons-regular-straight.css'>

    <!---------------------------------- SWIPER CSS ---------------------------------->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>

    <!-------------------------------- GOOGLE FONTS --------------------------------->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-------------------------------- CSS --------------------------------->
    <link rel="stylesheet" href="chandriahomepage/assets/css/styles.css" />

    <!-- Firebase SDK -->
    <script type="module" src="admin/firebase-config.js"></script>

    <title>Chandria's La Robe - Premium Attire Rentals</title>
  </head>
  <body>
    <!-------------------------------- HEADER -------------------------------->
    <header class="header">
      <nav class="nav container">
        <a href="index.html" class="nav-logo">
          <img src="chandriahomepage/assets/img/logo1.png" alt="" class="nav-logo-img">
        </a>

        <div class="nav-menu" id="nav-menu">
          <ul class="nav-list">
            <li class="nav-item">
              <a href="index.html" class="nav-link active-link">Home</a>
            </li>

            <li class="nav-item">
              <a href="chandriahomepage/shop.html" class="nav-link">Shop</a>
            </li>

          </ul>

          <div class="header-search">
            <input type="text" placeholder="Search" class="form-input">
            <button class="search-btn">
              <img src="chandriahomepage/assets/img/search.png" alt="">

            </button>
          </div>
        </div>

        <div class="header-user-actions">

          <a href="chandriahomepage/wishlist.html" class="header-action-btn">
            <img src="chandriahomepage/assets/img/icon-heart.svg" alt="">
            <span class="count">0</span>
          </a>

          <a href="chandriahomepage/cart.html" class="header-action-btn">
            <img src="chandriahomepage/assets/img/icon-cart.svg" alt="">
            <span class="count" id="cart-count">0</span>
          </a>

          <a href="chandriahomepage/accounts.html" class="header-action-btn" id="user-account-link">
            <img src="chandriahomepage/assets/img/icon-user.svg" alt="">
          </a>
          

        </div>

      </nav>
    </header>

    <!--------------------------------MAIN -------------------------------->
    <main class="main">
      <!-------------------------------- HOME -------------------------------->
      <section class="home section-lg">
        <div class="home-container container grid">
          <div class="home-content">
            <span class="home-subtitle">Discover Elegance in Every Outfit</span>
            <h1 class="home-title">Premium Attire for
                              <span>Every Occasion</span>
            </h1>
            <p class="home-description">
              Stylish Rentals, Hassle-Free Experience
            </p>
            <a href="chandriahomepage/shop.html" class="btn btn-primary">Book Now</a>
          </div>

          <img src="chandriahomepage/assets/img/home-img3.png" alt="" class="home-img">
        </div>
      </section>      <!-------------------------------- CATEGORIES -------------------------------->
      <section class="categories container section">
        <h3 class="section-title">
          <span>Popular</span> Categories</h3>

          <div class="categories-container swiper">
            <div class="swiper-wrapper">              <a href="chandriahomepage/shop.html?category=ball-gowns" class="category-item swiper-slide">
                <img src="chandriahomepage/assets/img/category-1.jpg" alt="Ball Gowns" class="category-img">
                <h3 class="category-title">Ball Gowns</h3>
              </a>

              <a href="chandriahomepage/shop.html?category=long-gowns" class="category-item swiper-slide">
                <img src="chandriahomepage/assets/img/category-2.jpg" alt="Long Gowns" class="category-img">
                <h3 class="category-title">Long Gowns</h3>
              </a>

              <a href="chandriahomepage/shop.html?category=wedding-gowns" class="category-item swiper-slide">
                <img src="chandriahomepage/assets/img/category-3.jpg" alt="Wedding Gowns" class="category-img">
                <h3 class="category-title">Wedding Gowns</h3>
              </a>

              <a href="chandriahomepage/shop.html?category=fairy-gowns" class="category-item swiper-slide">
                <img src="chandriahomepage/assets/img/category-4.jpg" alt="Fairy Gowns" class="category-img">
                <h3 class="category-title">Fairy Gowns</h3>
              </a>

              <a href="chandriahomepage/shop.html?category=suits" class="category-item swiper-slide">
                <img src="chandriahomepage/assets/img/category-5.jpg" alt="Suits" class="category-img">
                <h3 class="category-title">Suits</h3>
              </a>

              <a href="chandriahomepage/shop.html?category=additionals" class="category-item swiper-slide">
                <img src="chandriahomepage/assets/img/category-6.jpg" alt="Additionals" class="category-img">
                <h3 class="category-title">Additionals</h3>
              </a>
            </div>
          
          <div class="swiper-button-next">
            <i class="fi fi-rs-angle-right"></i>
          </div>
          <div class="swiper-button-prev">
            <i class="fi fi-rs-angle-left"></i>
          </div>

          </div>
      </section>

      <!-------------------------------- POLICY -------------------------------->
      <section class="policy section">
        <div class="policy-container container grid"></div>

      </section>      <!-------------------------------- FRESH ON THE RACK -------------------------------->
      <section class="fresh-ontherack container section">
        <h3 class="section-title">
          <span>Fresh </span>on the Rack
        </h3>
        <div class="products-container grid" id="fresh-products-container">
          <!-- Fresh products will be loaded here from inventory -->
        </div>
      </section>

    </main>

    <!---------------------------------- SWIPER JS ---------------------------------->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <!-------------------------------- JS --------------------------------->
    <script src="chandriahomepage/assets/js/main.js"></script>    <script type="module">
import { getAuth, onAuthStateChanged, doc, getDoc, signOut } from "./chandriahomepage/assets/js/sdk/chandrias-sdk.js";
import { chandriaDB, collection, getDocs, query, orderBy, limit } from "./chandriahomepage/assets/js/sdk/chandrias-sdk.js";

const auth = getAuth();
const loginLogoutLinkElement = document.getElementById('login-logout-link'); // This might be for a different element not shown in selection
const userAccountLink = document.getElementById('user-account-link');

// Function to create product HTML
function createProductHTML(product, productId) {
    // Get available sizes as a string
    const availableSizes = product.size ? Object.keys(product.size).join(", ") : "N/A";
    
    // Determine product category display
    const categoryDisplay = product.category || "Clothing";
    
    // Format price - assuming it's stored as a number
    const price = product.price ? `â‚± ${product.price}/24hr` : "Price TBA";
    
    return `
        <div class="product-item">
            <div class="product-banner">
                <a href="chandriahomepage/details.html?id=${productId}" class="product-images">
                    <img src="${product.frontImageUrl || 'chandriahomepage/assets/img/placeholder.jpg'}" alt="${product.name || 'Product'}" class="product-img default">
                    ${product.backImageUrl ? `<img src="${product.backImageUrl}" alt="${product.name || 'Product'}" class="product-img hover">` : ''}
                </a>
                <div class="product-actions">
                    <a href="#" class="action-btn" aria-label="Quick View">
                        <i class="fi fi-rs-eye"></i>
                    </a>
                    <a href="#" class="action-btn" aria-label="Add to Favorites">
                        <i class="fi fi-rs-heart"></i>
                    </a>
                    <a href="#" class="action-btn" aria-label="Share">
                        <i class="fi fi-rs-shuffle"></i>
                    </a>
                </div>
                <div class="product-badge light-pink">New</div>
            </div>
            <div class="product-content">
                <span class="product-category">${categoryDisplay}</span>
                <a href="chandriahomepage/details.html?id=${productId}">
                    <h3 class="product-title">${product.name || 'Untitled Product'}</h3>
                </a>
                <div class="product-price flex">
                    <span class="new-price">${price}</span>
                </div>
                <a href="#" class="action-btn cart-btn" aria-label="Add to Rent List">
                    <i class="fi fi-rs-shopping-bag-add"></i>
                </a>
            </div>
        </div>
    `;
}

// Function to load fresh products (most recent)
async function loadFreshProducts() {
    try {
        const freshContainer = document.getElementById('fresh-products-container');
        if (!freshContainer) return;
        
        // Show loading state
        freshContainer.innerHTML = '<div class="loading">Loading fresh products...</div>';
        
        // Query for most recent products (limited to 4)
        const productsQuery = query(
            collection(chandriaDB, "products"),
            orderBy("createdAt", "desc"),
            limit(4)
        );
        
        const querySnapshot = await getDocs(productsQuery);
        
        if (querySnapshot.empty) {
            freshContainer.innerHTML = '<div class="no-products">No products available at the moment.</div>';
            return;
        }
        
        let productsHTML = '';
        querySnapshot.forEach((doc) => {
            const productData = doc.data();
            // Only add if product has required fields
            if (productData.frontImageUrl && productData.name) {
                productsHTML += createProductHTML(productData, doc.id);
            }
        });
        
        if (productsHTML === '') {
            freshContainer.innerHTML = '<div class="no-products">No products available at the moment.</div>';
        } else {
            freshContainer.innerHTML = productsHTML;
        }
        
    } catch (error) {
        console.error("Error loading fresh products:", error);
        const freshContainer = document.getElementById('fresh-products-container');
        if (freshContainer) {
            freshContainer.innerHTML = '<div class="error">Unable to load products. Please try again later.</div>';
        }
    }
}



// Cart count update function
async function updateCartCount() {
    const user = auth.currentUser;

    if (!user) {
        document.getElementById("cart-count").textContent = "0";
        return;
    }

    try {
        const userRef = doc(chandriaDB, "userAccounts", user.uid);
        const userSnap = await getDoc(userRef);

        if (userSnap.exists()) {
            const data = userSnap.data();
            const cartItems = data.added_to_cart || [];
            const totalCount = cartItems.reduce((sum, item) => sum + (parseInt(item.quantity, 10) || 0), 0);
            document.getElementById("cart-count").textContent = totalCount;
        }
    } catch (error) {
        console.error("Error fetching cart count: ", error);
        document.getElementById("cart-count").textContent = "0";
    }
}

// Load products when page loads
document.addEventListener('DOMContentLoaded', function() {
    loadFreshProducts();
});

onAuthStateChanged(auth, (user) => {
  if (user) {
    if (loginLogoutLinkElement) { // Check if the element exists
        loginLogoutLinkElement.style.display = 'none';
    }
    if (userAccountLink) {
        userAccountLink.href = "chandriahomepage/accounts.html";
    }
    localStorage.setItem('userEmail', user.email); // Store user's email
    updateCartCount(); // Update cart count when user is logged in
  } else {
    if (loginLogoutLinkElement) { // Check if the element exists
        loginLogoutLinkElement.style.display = 'block';
        loginLogoutLinkElement.textContent = "Login";
        loginLogoutLinkElement.href = "/chandriahomepage/user_authentication.html";
    }
    if (userAccountLink) {
        userAccountLink.href = "chandriahomepage/user_authentication.html";
    }
    localStorage.removeItem('userEmail'); // Remove user's email on logout
    document.getElementById("cart-count").textContent = "0"; // Reset cart count when logged out
  }
});
</script>
  </body>
</html>
